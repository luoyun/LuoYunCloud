<%inherit file="admin_base.html"/>

<%block name="submenujs">
$("#admin-menu #index-item").addClass("current");
</%block>

<%block name="content">

<div id="system-global-info" class="admin-index-item">
  <table>
    <thead>
      <tr>
        <th>${ _("Appliance") }</th>
        <th>${ _("Instance") }</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><a href="${ reverse_url('admin:appliance') }">${ TOTAL_APPLIANCE }</a></td>
        <td><a href="${ reverse_url('admin:instance') }">${ TOTAL_INSTANCE }</a></td>
      </tr>
    </tbody>
  </table>
</div>

<div id="admin-pie-show" class="admin-index-item c">
  <div class="pie" id="admin-cpu-pie"></div>
  <div class="pie" id="admin-mem-pie"></div>
</div>

<script language="JavaScript" src="${ static_url('FusionCharts/JSClass/FusionCharts.js') }"></script>
<script type="text/javascript">
  var cpuData = "<graph caption=\"${ _('CPU USED INFO') }\" subCaption=\"${ _("TOTAL: ") }${ TOTAL_CPU }CPU\" showNames='1' bgColor='F4F8FC' decimalPrecision='0' formatNumberScale='0' baseFontSize='16' baseFontColor='444450' numberSuffix=\"${ _('core') }\">" +
    "<set name=\"${ _('Used') }\" value='${ USED_CPU }' color='FC0101' />" +
    "<set name=\"${ _('Unused') }\" value='${ TOTAL_CPU - USED_CPU }' color='AFD8F8' />" +
    "</graph>";
  var cpuChart = new FusionCharts("${ static_url('FusionCharts/Charts/FCF_Pie2D.swf') }", "cpuChartId", "420", "220");
  cpuChart.setDataXML(cpuData);
  cpuChart.render("admin-cpu-pie");

  var memData = "<graph caption=\"${ _('MEMORY USED INFO') }\" subCaption=\"${ _("TOTAL: ") }${ human_size(TOTAL_MEMORY * 1024) }\" showNames='1' bgColor='F4F8FC' decimalPrecision='0' formatNumberScale='0' baseFontSize='16' numberSuffix='M'>" +
    "<set name=\"${ _('Used') }\" value='${ USED_MEMORY/1024 }' color='FC0101' />" +
    "<set name=\"${ _('Unused') }\" value='${ (TOTAL_MEMORY - USED_MEMORY)/1024 }' color='AFD8F8' />" +
    "</graph>";
  var memChart = new FusionCharts("${ static_url('FusionCharts/Charts/FCF_Pie3D.swf') }", "memChartId", "420", "220");
  memChart.setDataXML(memData);
  memChart.render("admin-mem-pie");
</script>


% if NEW_USER_LIST:
<div id="admin-new-user" class="admin-user-list ly-table c">
  <h3 class="subtitle">${ _("Last 10 users") }</h3>
  <p class="manage-content"><a href="${ reverse_url('admin:user') }">${ _("View All User") }</a></p>
  <table>
    <thead>
      <tr>
        <th>${ _("ID") }</th>
        <th>${ _("Name") }</th>
	<th>${ _("Groups") }</th>
	<th>${ _("Appliance") }</th>
	<th>${ _("Instance") }</th>
	<th>${ _("Email") }</th>
	<th>${ _("Last Active") }</th>
      </tr>
    </thead>
    <tbody>
      % for U in NEW_USER_LIST:
      <tr>
        <td>${ U.id }</td>
        <td>
	  <a class="action" href="${ reverse_url('admin:user') }?id=${ U.id }">${ U.username }</a>
	</td>
	<td>
	  % for G in U.groups:
	  <a href="${ reverse_url('admin:group') }?id=${ G.id }">${ G.name }</a>
	  % endfor
	</td>
	<td>
	  % if U.appliances:
	  <a href="${ reverse_url('admin:appliance') }?uid=${ U.id }">${ len(U.appliances) }</a>
	  % endif
	</td>
	<td>
	  % if U.instances:
	  <a href="${ reverse_url('admin:instance') }?uid=${ U.id }">${ len(U.instances) }</a>
	  % endif
	</td>
	<td>
	  % if U.profile and U.profile.email:
	  ${ U.profile.email }
	  % endif
	</td>
	<td>${ htime(U.last_active) }</td>
      </tr>
      % endfor
    </tbody>
  </table>
</div>
% endif

% if NEW_JOB_LIST:
<div id="admin-new-job" class="ly-table c">
  <h3 class="subtitle">${ _("Last 10 jobs") }</h3>
  <p class="manage-content"><a href="${ reverse_url('admin:job') }">${ _("View All Job") }</a></p>
  <table>
    <thead>
      <tr>
        <th>${ _("ID") }</th>
        <th>${ _("User") }</th>
        <th>${ _("Status") }</th>
        <th>${ _("Target Type") }</th>
        <th>${ _("Target ID") }</th>
        <th>${ _("Action") }</th>
        <th>${ _("Completed") }</th>
      </tr>
    </thead>
    <tbody>
      % for j in NEW_JOB_LIST:
      <tr>
        <td>${ j.id }</td>
        <td><a href="${ reverse_url('admin:user') }?id=${ j.user.id }">${ j.user.username }</a></td>
        <td><img src="${ THEME_URL }icons/JobStatus/${ j.status }.png"/>${ j.status_string }</td>
        <td>${ j.target_name }</td>
        <td><a href="${ j.target_url }">${ j.target_id }</a></td>
        <td>${ j.action_string }</td>
        <td>${ htime(j.ended) }</td>
      </tr>
      % endfor
    </tbody>
  </table>
</div>
% endif

</%block>
