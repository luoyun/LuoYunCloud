<%inherit file="/myun/instance_base.html" />

<%block name="instance">

<%
   def isshow(tab):
       return '' if tab == TAB else 'display:none;'
%>

<div id="tab-content-general" class="tab-content" style="${ isshow('general') }">

  <div id="i-baseinfo" class="c">
    <table>
      <tbody>
	<tr>
	  <td>${ _("Name") }</td>
	  <td>${ I.name }</td>
	</tr>
	<tr>
	  <td>${ _("Domain") }</td>
	  <td>
	    <span id="i-domain">
	      % if I.domain:
	      % if I.is_running:
	      <a href="${ I.home_url(current_user) }" target="_blank">${ I.domain }</a>
	      % else:
	      ${ I.domain }
	      % endif
	      % endif
	    </span>
	  </td>
	</tr>
	<tr>
	  <td>${ _("IP") }</td>
	  <td>
	    <span id="i-ip">
	      % if I.work_ip:
	      <a href="${ I.home_url(current_user, useip=True) }" target="_blank"><span id="lyinst-ip">${ I.work_ip }</span></a>
	      % endif
	    </span>
	  </td>
	</tr>
	<tr>
	  <td>${ _("VDI") }</td>
	  <td><span id="i-vdi_ip">${ I.vdi_ip }</span>:<span id="i-vdi_port">${ I.vdi_port }</span></td>
	</tr>
	<tr>
	  <td>${ _("Recent Action") }</td>
	  <td><span id="i-lastjob-id">${ I.lastjob_id }</span></td>
	</tr>
      </tbody>
    </table>

    <table>
      <tbody>
	<tr>
	  <td>${ _("Appliance") }</td>
	  <td><a href="${ reverse_url('appliance:view', I.appliance_id) }">${ I.appliance.name }</a></td>
	</tr>
	<tr>
          <td class="c1">${ _("Private") }</td>
	  <td class="c2 isprivate-checkbox">
	    <input type="checkbox"
		   % if I.isprivate:
		   checked="checked"
		   % endif
		   />
	    <span class="public-view"
		  % if I.isprivate:
		  style="display:none;"
		  % endif
		  ><a href="${ reverse_url('instance:view', I.id) }" target="_blank">${ _("Public Access") }</a>
	    </span>
	    <span style="display:none;" class="access-url">${ reverse_url('instance:set_private', I.id) }</span>
	  </td>
	</tr>
	<tr>
	  <td>${ _("Create Time") }</td>
	  <td>${ ftime(I.created) }</td>
	</tr>
	<tr>
	  <td>${ _("Update Time") }</td>
	  <td>${ ftime(I.updated) }</td>
	</tr>
      </tbody>
    </table>

  </div>

  <h2>${ _("Summary") }</h2>
  <p id="i-summary">
    % if I.summary:
    ${ I.summary }
    % else:
    ${ _("No summary yet.") }
    % endif
  </p>

  <h2>${ _("Description") }</h2>
  <div id="i-description" class="description">
    % if I.description:
    ${ I.description_html }
    % else:
    ${ _("No description yet.") }
    % endif
  </div>

  <div class="i-management-btn">
    <a class="blue-submit" href="${ reverse_url('myun:instance:edit', I.id) }?item=general">${ _("Edit") }</a>
  </div>
</div>

<div id="tab-content-resource" class="tab-content" style="${ isshow('resource') }">
  <h2>${ _("Resource") }</h2>
  <table class="kv">
    <tbody>
      <tr>
	<td>${ _("CPU numbers") }</td>
	<td>${ I.cpus }</td>
      </tr>
      <tr>
	<td>${ _("Memory") }</td>
	<td>${ I.memory }</td>
      </tr>
    </tbody>
  </table>

  <div class="i-management-btn">
    <span class="edit"><a class="blue-submit" href="${ reverse_url('myun:instance:edit', I.id) }?item=resource">${ _("Edit") }</a></span>
  </div>
</div>

<div id="tab-content-network" class="tab-content" style="${ isshow('network') }">
  <% NIC_TOTAL = len(NETWORK_LIST) %>

  % if NETWORK_LIST:

  % for N in NETWORK_LIST:
  <% INDEX = NETWORK_LIST.index(N) + 1 %>
  <h2>${ _("NIC") } ${ INDEX }</h2>
  <p>
    <a href="${ reverse_url('myun:instance:edit', I.id) }?item=network&index=${ INDEX }">${ _("Edit") }</a>
    %if INDEX!=1:
    <a href="${ reverse_url('myun:instance:edit', I.id) }?item=network_clean&index=${ INDEX }">${ _("Clean") }</a>
    %endif
  </p>
  <table class="kv">
    <tbody>
      <tr>
	<td>${ _("Type") }</td>
	<td>${ N.get('type') }</td>
      </tr>
      %if N.get('type') != 'default':
      <tr>
	<td>${ _("IP") }</td>
	<td>${ N.get('ip') }</td>
      </tr>
      <tr>
	<td>${ _("Gateway") }</td>
	<td>${ N.get('gateway') }</td>
      </tr>
      <tr>
	<td>${ _("Netmask") }</td>
	<td>${ N.get('netmask') }</td>
      </tr>
      %endif
      <tr>
	<td>${ _("MAC") }</td>
	<td>${ N.get('mac') }</td>
      </tr>
    </tbody>
  </table>
  % endfor

  % else:
  <p class="c">${ _("Appliance Default Configuration") }</p>
  % endif

  %if has_permission("network.add"):
  <div class="i-management-btn">
    <a class="blue-submit" href="${ reverse_url('myun:instance:edit', I.id) }?item=network&index=${ NIC_TOTAL + 1 }">${ _("Add a new NIC") }</a>
  </div>
  %endif


</div>


<div id="tab-content-storage" class="tab-content" style="${ isshow('storage') }">
  % if STORAGE_LIST:

  % for S in STORAGE_LIST:
  <h2>${ _("Configure Storage") }</h2>
  <table class="kv">
    <tr>
      <td>${ _("Type") }</td>
      <td>${ S.get('type') }</td>
    </tr>
    <tr>
      <td>${ _("Size") }</td>
      <td>${ S.get('size') }</td>
    </tr>
  </table>
  % endfor

  <div class="i-management-btn">
    <a class="blue-submit" href="${ reverse_url('myun:instance:edit', I.id) }?item=storage">${ _("Edit") }</a>
    <a class="red-submit" href="${ reverse_url('myun:instance:edit', I.id) }?item=storage_delete">${ _("Delete") }</a>
  </div>

  % else:
  <p>${ _("You can add a disk for the instance. ") }</p>
  <p><a class="blue-submit" href="${ reverse_url('myun:instance:edit', I.id) }?item=storage">${ _("Add") }</a></p>
  % endif
</div>


<div id="tab-content-secret" class="tab-content" style="${ isshow('secret') }">
  <h2>${ _("Password") }</h2>
  <p>${ _("Use Global Password") } <input type="checkbox"
	    % if USE_GLOBAL_PASSWD:
	    checked="checked"
	    % endif
	    onclick="checkboxClickNotify( this, '${ reverse_url('instance:toggle_flag', I.id) }?target=use_global_passwd', '${ _("Toggle Instance use_global_passwd flag Success") }')" /></p>
  <p>
    <a class="blue-submit" href="${ reverse_url('myun:instance:edit', I.id) }?item=password">${ _("Reset Root Password") }</a>
  </p>

  <h2>${ _("SSH Public Key") }</h2>
  <p>
    <a class="blue-submit" href="${ reverse_url('myun:instance:edit', I.id) }?item=public_key">${ _("Config public key") }</a>
  </p>
</div>

<div id="tab-content-domain" class="tab-content" style="${ isshow('domain') }">
  % if I.domain:
  <h2>${ _("Domain Binding") }</h2>

  <p>${ _("Domain name of the instance is ") }
    <span class="fulldomain">
      % if I.is_running:
      <a href="${ I.home_url(current_user) }" target="_blank">${ I.domain }</a>
      % else:
      ${ I.domain }
      % endif
    </span>
  </p>
  <div class="i-management-btn">
    <a class="blue-submit" href="${ reverse_url('myun:instance:edit', I.id) }?item=domain">${ _("Edit") }</a>
    <a class="red-submit" href="${ reverse_url('myun:instance:edit', I.id) }?item=domain_delete">${ _("Delete") }</a>
  </div>

  % else:
  <p>${ _("Domain is not configured.") }</p>
  <p><a class="blue-submit" href="${ reverse_url('myun:instance:edit', I.id) }?item=domain">${ _("Add") }</a></p>
  % endif
</div>

<div id="tab-content-webssh" class="tab-content" style="${ isshow('webssh') }">
  <table class="kv">
    <tbody>
      <tr>
	<td>${ _("WebSSH") }</td>
	<td><input type="checkbox"
		   % if webssh and webssh.get('status') == 'enable':
		   checked="checked"
		   % endif
		   onclick="checkboxClickNotify( this, '${ reverse_url('myun:instance:edit', I.id) }?item=webssh_toggle', '${ _("Toggle webssh status success") }')" />
	</td>
      </tr>
    </tbody>
  </table>
</div>

<div id="tab-content-delete" class="tab-content" style="${ isshow('delete') }">
  <h2>${ _("Delete instance") }</h2>
  <p class="ly-warning2">${ _("Wait! All the instance data will be lost after instance is deleted.") }</p>
  <div class="i-management-btn">
    <a class="ly-btn2 small green confirm-action" onclick="deleteInstanceConfirm( this ); return false;" href="/instance/${ I.id }/delete?_xsrf=${ xsrf_cookie }">${ _("Delete") }</a>
  </div>

  <div id="i-delete-confirm-dialog" style="display:none;">
    <table class="vertical-align">
      <tr>
	<td><img class="ywarn-img" src="${ theme_url('img/warning48.png') }"/></td>
	<td><span class="ywarn">${ _("Wait! All the instance data will be lost after instance is deleted.") }</span></td>
      </tr>
    </table>
  </div>
</div>

<div id="tab-content-joblist" class="tab-content" style="${ isshow('joblist') }">
  % if JOB_LIST.count():
  <h2>${ _("Recent Job History") }</h2>
  <table class="ly-table">
    <tbody>
      <tr>
        <th>${ _("Job ID") }</th>
        <th>${ _("User") }</th>
        <th>${ _("Action") }</th>
        <th>${ _("Result") }</th>
        <th>${ _("Start Time") }</th>
        <th>${ _("End Time") }</th>
      </tr>
      % for J in JOB_LIST:
      <tr>
        <td>${ J.id }</td>
        <td><a href="${ reverse_url('account:view', J.user.id) }">${ J.user.username }</a></td>
        <td>${ J.action_string }</td>
        <td>${ locale.translate(J.status_string) }</td>
        <td>${ ftime(J.started) }</td>
        <td>${ ftime(J.ended) }</td>
      </tr>
      % endfor
    </tbody>
  </table>
  % endif
</div>


<script type="text/javascript">
  $("html").data("inst_control_url", "${ reverse_url('instance:control', I.id) }");
  $("html").data("inst_control_imgsrc", "${ theme_url('img/REPLACE-instance.png') }");

  InstanceControl();

  $("html").data("i-ctn-reboot-link", '<a id="i-control-reboot" href="${ reverse_url('instance:control', I.id) }?action=reboot"><img src="${ theme_url('img/reboot-instance.png') }"/></a>');

  $("html").data("job-running-img", "${ theme_url('icons/JobStatus/running.gif') }");
  $("html").data("instance-id", "${ I.id }");
  InstanceStatusUpdate();

  checkboxToggle();
  toggleStatus();
</script>

<script type="text/javascript">
function deleteInstanceConfirm( obj ) {

   var $obj = $(obj);

    $('#i-delete-confirm-dialog').dialog({
	title: "${ _('Are you sure ?') }",
	resizable: false,
	height: "auto",
	minWidth: 520,
	modal: true,
	buttons: {
	    "${ _('Cancel') }": function() {
		$( this ).dialog( "close" );
	    },
	    "${ _('Delete Instance') }": function() {
		$.ajax({
		    url: $obj.attr("href"),
		    type: 'GET',
		    success: function(data) {
			$(data).dialog({
			    show: "slow",
			    minWidth: 520,
			    modal: true
			});
		    }
		});
		$( this ).dialog( "close" );
	    }
	},
        close:function(){
            $( this ).dialog("destroy");
        }
    });

    return false;

}
</script>

</%block>
